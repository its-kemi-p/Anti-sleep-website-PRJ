<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Live Status Dashboard</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Optional custom CSS -->
    <link rel="stylesheet" href="stylelive.css" />
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <!-- Sidebar -->
        <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
          <div class="position-sticky pt-3">
            <h4 class="sidebar-heading px-3 mt-4 mb-3 text-muted">
              Anti-Sleep Glasses
            </h4>
            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link" href="index.html">Dashboard</a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" href="#">Live Status</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="drivingSummary.html"
                  >Session Summary</a
                >
              </li>
              <li class="nav-item"><a class="nav-link" href="#">Charts</a></li>
              <li class="nav-item">
                <a class="nav-link" href="#">Settings</a>
              </li>
            </ul>
          </div>
        </nav>

        <!-- Main Content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
          <div class="pt-3 pb-2 mb-3 border-bottom">
            <h1 class="h2">Live Status Dashboard</h1>
          </div>

          <!-- Live Status Badges -->
          <div class="d-flex gap-3 mt-3">
            <div>
              <strong>Connection:</strong>
              <span id="liveConnectionStatus" class="badge bg-secondary"
                >Loading...</span
              >
            </div>
            <div>
              <strong>Alert:</strong>
              <span id="liveCurrentAlert" class="badge bg-secondary"
                >Loading...</span
              >
            </div>
          </div>

          <!-- Live Charts -->
          <div class="row mt-4">
            <div class="col-md-6">
              <div class="card mb-4">
                <div class="card-header">Blinks Per Minute</div>
                <div class="card-body">
                  <canvas id="liveBlinksChart"></canvas>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card mb-4">
                <div class="card-header">Head Movements</div>
                <div class="card-body">
                  <canvas id="liveHeadMovementsChart"></canvas>
                </div>
              </div>
            </div>
          </div>

          <!-- Live Driving Sessions Table -->
          <div class="card mb-4">
            <div class="card-header">Recent Driving Sessions</div>
            <div class="card-body">
              <table id="liveSessionTable" class="table table-hover">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Duration</th>
                    <th>Alerts</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Populated dynamically -->
                </tbody>
              </table>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Live Status Script -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Initialize charts
        const blinksCtx = document
          .getElementById("liveBlinksChart")
          .getContext("2d");
        const liveBlinksChart = new Chart(blinksCtx, {
          type: "line",
          data: {
            labels: ["08:00", "08:15", "08:30"],
            datasets: [
              {
                label: "Blinks",
                data: [0, 0, 0],
                borderColor: "red",
                fill: true,
              },
            ],
          },
          options: { responsive: true, maintainAspectRatio: false },
        });

        const headCtx = document
          .getElementById("liveHeadMovementsChart")
          .getContext("2d");
        const liveHeadMovementsChart = new Chart(headCtx, {
          type: "bar",
          data: {
            labels: ["08:00", "08:15", "08:30"],
            datasets: [
              { label: "Head Tilts", data: [0, 0, 0], backgroundColor: "blue" },
            ],
          },
          options: { responsive: true, maintainAspectRatio: false },
        });

        // Update live badges, charts, and table every 3 seconds
        setInterval(() => {
          const connected = Math.random() > 0.1;
          const drowsy = Math.random() > 0.7;

          // Badges
          const connBadge = document.getElementById("liveConnectionStatus");
          connBadge.textContent = connected ? "Connected" : "Disconnected";
          connBadge.className = connected
            ? "badge bg-success"
            : "badge bg-danger";

          const alertBadge = document.getElementById("liveCurrentAlert");
          alertBadge.textContent = drowsy
            ? "Drowsiness Detected!"
            : "No Drowsiness";
          alertBadge.className = drowsy
            ? "badge bg-danger"
            : "badge bg-warning text-dark";

          // Charts
          liveBlinksChart.data.datasets[0].data =
            liveBlinksChart.data.datasets[0].data.map(() =>
              Math.floor(Math.random() * 30)
            );
          liveBlinksChart.update();

          liveHeadMovementsChart.data.datasets[0].data =
            liveHeadMovementsChart.data.datasets[0].data.map(() =>
              Math.floor(Math.random() * 5)
            );
          liveHeadMovementsChart.update();

          // Table
          const tbody = document.querySelector("#liveSessionTable tbody");
          tbody.innerHTML = "";
          for (let i = 0; i < 5; i++) {
            const date = new Date();
            tbody.innerHTML += `<tr>
                        <td>${date.toISOString().split("T")[0]}</td>
                        <td>${Math.floor(Math.random() * 2 + 1)} hours</td>
                        <td>${Math.floor(Math.random() * 5)}</td>
                        <td>${Math.random() > 0.5 ? "Safe" : "Alert"}</td>
                    </tr>`;
          }
        }, 3000);
      });
    </script>
  </body>
</html>
